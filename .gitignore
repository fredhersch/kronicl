# Dependencies
node_modules/
package-lock.json

# Next.js
.next/
out/
build/
dist/

# Webpack cache
.next/cache/

# Firebase Functions
functions/node_modules/
functions/package-lock.json

# Remove from Git tracking
git rm -r --cached .next/ 2>/dev/null || true

# Remove .next directory from Git history
git filter-branch --force --index-filter 'git rm -r --cached --ignore-unmatch .next' --prune-empty --tag-name-filter cat -- --all

# Remove node_modules from Git history
git filter-branch --force --index-filter 'git rm -r --cached --ignore-unmatch node_modules' --prune-empty --tag-name-filter cat -- --all

# Remove functions/node_modules from Git history
git filter-branch --force --index-filter 'git rm -r --cached --ignore-unmatch functions/node_modules' --prune-empty --tag-name-filter cat -- --all

# Remove package-lock.json from Git history
git filter-branch --force --index-filter 'git rm --cached --ignore-unmatch package-lock.json' --prune-empty --tag-name-filter cat -- --all

# Remove the backup refs created by filter-branch
git for-each-ref --format="%(refname)" refs/original/ | xargs -n 1 git update-ref -d

# Force garbage collection to remove the large files
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# Force push the cleaned history
git push --force-with-lease origin main